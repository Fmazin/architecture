<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Software architecture for Opening Reproducible Research">
  <meta name="author" content="o2r project">
  <link rel="shortcut icon" href="./img/favicon.ico">
  <title>Architecture - Architecture for o2r</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="./css/theme.css" type="text/css" />
  <link rel="stylesheet" href="./css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="./css/highlight.css">
  <link href="./arc42.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Architecture";
    var mkdocs_page_input_path = "index.md";
    var mkdocs_page_url = "/";
  </script>
  
  <script src="./js/jquery-2.1.1.min.js"></script>
  <script src="./js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="./js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="." class="icon icon-home"> Architecture for o2r</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1 current">
		
    <a class="current" href=".">Architecture</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#software-architecture-for-opening-reproducible-research">Software architecture for Opening Reproducible Research</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#1-introduction-and-goals">1. Introduction and Goals</a></li>
        
            <li><a class="toctree-l3" href="#2-architecture-constraints">2. Architecture constraints</a></li>
        
            <li><a class="toctree-l3" href="#3-system-scope-and-context">3. System scope and context</a></li>
        
            <li><a class="toctree-l3" href="#4-solution-strategy">4. Solution strategy</a></li>
        
            <li><a class="toctree-l3" href="#5-building-block-view">5. Building block view</a></li>
        
            <li><a class="toctree-l3" href="#credits">Credits</a></li>
        
            <li><a class="toctree-l3" href="#license">License</a></li>
        
            <li><a class="toctree-l3" href="#about-arc42">About arc42</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="user-scenarios/">User scenarios</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="glossary/">Glossary</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="metadata/">Metadata</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href=".">Architecture for o2r</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".">Docs</a> &raquo;</li>
    
      
    
    <li>Architecture</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/o2r-project/architecture/tree/master/docs/index.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="software-architecture-for-opening-reproducible-research">Software architecture for Opening Reproducible Research<a class="headerlink" href="#software-architecture-for-opening-reproducible-research" title="Permanent link">&para;</a></h1>
<h2 id="1-introduction-and-goals">1. Introduction and Goals<a class="headerlink" href="#1-introduction-and-goals" title="Permanent link">&para;</a></h2>
<h3 id="11-requirements-overview">1.1 Requirements Overview<a class="headerlink" href="#11-requirements-overview" title="Permanent link">&para;</a></h3>
<p>The system must provide a reliable way to create and examine (e.g. discover, inspect) reproducibility packages of computational research to support reproducible publications.
This architecture describes the relationship of the reproducibility service with other services from the context of scientific collaboration and publishing and how they can be combined to a new system for scholarly publications.</p>
<p>At its core is the concept of the <strong>Executable Research Compendium</strong> (ERC, see <a href="http://o2r.info/erc-spec">specification</a> and <a href="https://doi.org/10.1045/january2017-nuest">article</a>), and a supporting reproducibility service, which is defined by a <a href="http://o2r.info/o2r-web-api/">web <strong>API</strong> specification</a> and its <a href="https://github.com/o2r-project/reference-implementation"><strong>reference implementation</strong></a> is published as open source software.</p>
<h3 id="12-quality-goals">1.2 Quality Goals<a class="headerlink" href="#12-quality-goals" title="Permanent link">&para;</a></h3>
<dl>
<dt>Transparency</dt>
<dd>The system must be transparent to allow scrutiny required by a rigorous scientific process.</dd>
<dt>Separation of concern</dt>
<dd>The system must integrate with existing services and focus on the core functionality.
It must not replicate existing functionality such as storage or persistent identification.</dd>
<dt>Flexibility &amp; modularity</dt>
<dd>In regard to the research project setting, the system components must be well separated, so functions can be developed independently, e.g. using different programming languages.
This allows different developers to contribute efficiently.</dd>
</dl>
<h3 id="13-stakeholders">1.3 Stakeholders<a class="headerlink" href="#13-stakeholders" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Role/Name</th>
<th>Goal/point of contact</th>
<th>Required interaction</th>
</tr>
</thead>
<tbody>
<tr>
<td>Author (scientist)</td>
<td>publish ERC as part of a scientific publication process</td>
<td>-</td>
</tr>
<tr>
<td>Reviewer (scientist)</td>
<td>examine ERC during a review process</td>
<td>-</td>
</tr>
<tr>
<td>Co-author (scientist)</td>
<td>contribute to ERC during research (e.g. cloud based)</td>
<td>-</td>
</tr>
<tr>
<td>Reader (scientist)</td>
<td>view and interact with ERC on a journal website</td>
<td>-</td>
</tr>
<tr>
<td>Publisher</td>
<td>increase quality of publications in journals with ERC</td>
<td>-</td>
</tr>
<tr>
<td>Curator/preservationist</td>
<td>ensure research is complete and archivable using ERC</td>
<td>-</td>
</tr>
<tr>
<td>Operator</td>
<td>provide infrastructure to researchers at my university to collaborate and conduct high-quality research using ERC</td>
<td>-</td>
</tr>
<tr>
<td>Developer</td>
<td>use and extend the tools around ERC</td>
<td>-</td>
</tr>
</tbody>
</table>
<p>Some of the stakeholders are accompanied by <a href="user-scenarios/">user scenarios</a> in prose.</p>
<h2 id="2-architecture-constraints">2. Architecture constraints<a class="headerlink" href="#2-architecture-constraints" title="Permanent link">&para;</a></h2>
<p>The few constraints on this project are reflected in the final solution. This section shows them and if applicable, their motivation. (based on <a href="https://biking.michael-simons.eu/docs/index.html#section-architecture-constraints">biking2</a>)</p>
<h3 id="21-technical-constraints">2.1 Technical constraints<a class="headerlink" href="#21-technical-constraints" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>&nbsp;</th>
<th>Constraint</th>
<th>Background and/or motivation</th>
</tr>
</thead>
<tbody>
<tr>
<td>TECH.1</td>
<td>Only open licenses</td>
<td>All third party software or used data must be available under a suitable code license, i.e. either <a href="https://opensource.org/licenses">OSI-approved</a> or <a href="https://opendatacommons.org/licenses">ODC license</a>.</td>
</tr>
<tr>
<td>TECH.2</td>
<td>OS independent development and deployment</td>
<td>Server applications must run in well defined <a href="https://docker.com">Docker</a> containers to allow installation on any host system and to not limit developers to a specific language or environment.</td>
</tr>
<tr>
<td>TECH.3</td>
<td>Do not store secure information</td>
<td>The team members experience and available resources do not allow for handling information with security concerns, so no critical data, such as user passwords but also data with privacy concerns, must be stored in the system.</td>
</tr>
</tbody>
</table>
<h3 id="22-organizational-constraints">2.2 Organizational constraints<a class="headerlink" href="#22-organizational-constraints" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>&nbsp;</th>
<th>Constraint</th>
<th>Background and/or motivation</th>
</tr>
</thead>
<tbody>
<tr>
<td>ORG.1</td>
<td>Team and schedule</td>
<td><a href="http://o2r.info/about">http://o2r.info/about</a></td>
</tr>
<tr>
<td>ORG.2</td>
<td>Do not interfere with existing well-established peer-review process</td>
<td>This software is <em>not</em> going to change how scientific publishing works, nor should it. While intentioned to support public peer-reviews, open science etc., the software should be agnostic of these aspects.</td>
</tr>
<tr>
<td>ORG.3</td>
<td>Only open licenses</td>
<td>All created software must be available under an <a href="https://opensource.org/licenses">OSI-approved</a> license, documentation and specification under a <a href="https://creativecommons.org/licenses">CC license</a>.</td>
</tr>
<tr>
<td>ORG.4</td>
<td>Version control/management</td>
<td>Code must be versioned using <code>git</code> and published on <a href="https://github.com/o2r-project">GitHub</a>.</td>
</tr>
<tr>
<td>ORG.5</td>
<td>Transfer from group domain to persistent domain</td>
<td>The ERC bundles artifacts coming from a private or group domain for a transfer to a public and persistent domain (cf. <a href="http://www.forschungsdaten.org/index.php/Curation_Domain_Model">Curation Domain Model</a>), which imposes requirements on the availability and enrichment of metadata</td>
</tr>
</tbody>
</table>
<h3 id="23-conventions">2.3 Conventions<a class="headerlink" href="#23-conventions" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>&nbsp;</th>
<th>Constraint</th>
<th>Background and/or motivation</th>
</tr>
</thead>
<tbody>
<tr>
<td>CONV.1</td>
<td>Provide architecture documentation</td>
<td>Based on <a href="http://arc42.org/">arc42</a> (template version 7.0).</td>
</tr>
<tr>
<td>CONV.2</td>
<td>Reasonably follow coding conventions</td>
<td>Typical project layout and coding conventions of the respective used language should be followed as far as possible. However, we explicitly accept the research project context and do <em>not</em> provide full tests suites or documentation beyond what is needed by project team members.</td>
</tr>
<tr>
<td>CONV.3</td>
<td>Documentation is English</td>
<td>International research project, must be understandable by anyone interested.</td>
</tr>
<tr>
<td>CONV.4</td>
<td>Use subjectivization for server component names</td>
<td>Server-side components are named using personalized verbs or professions: <em>muncher</em>, <em>loader</em>, <em>transporter</em>. All git repositories for software use an <code>o2r-</code> prefix, in case of server-side components e.g. <code>o2r-shipper</code>.</td>
</tr>
<tr>
<td>CONV.5</td>
<td>Configuration using environment variables</td>
<td>Server-side components must be configurable using all caps environment variables prefixed with the component name, e.g. <code>SHIPPER_THE_SETTING</code>, for required settings. Other settings should be put in a settings file suitable for the used language, e.g. <code>config.js</code> or <code>config.yml</code>.</td>
</tr>
</tbody>
</table>
<h2 id="3-system-scope-and-context">3. System scope and context<a class="headerlink" href="#3-system-scope-and-context" title="Permanent link">&para;</a></h2>
<h3 id="31-business-context">3.1 Business context<a class="headerlink" href="#31-business-context" title="Permanent link">&para;</a></h3>
<p><a href="./img/3.1-business-context.png"><img alt="business context" src="./img/3.1-business-context.png" /></a></p>
<table>
<thead>
<tr>
<th>Communication partner</th>
<th>Exchanged data</th>
<th>Technology/protocol</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Reproducibility service</strong>, e.g. <a href="http://o2r.info/results">o2r</a></td>
<td>publication platforms utilize creation and examination services for ERC, reproducibility service uses repositories to retrieve software artifacts, store runtime environment images, and save complete ERC</td>
<td><code>HTTP</code> APIs</td>
</tr>
<tr>
<td><strong>Publication platform</strong>, e.g. online journal website and review system</td>
<td>users access ERC status and metadata via search results and paper landing pages; review process integrates ERC details and supports manipulation;</td>
<td>system's API using <code>HTTP</code> with <code>JSON</code> payload</td>
</tr>
</tbody>
</table>
<p><strong>ID provider</strong> | retrieve unique user IDs, user metadata, and authentication tokens; user must log in with the provider | <code>HTTP</code>
<strong>Execution infrastructure</strong> | ERC can be executed using a shared/distributed infrastructure | <code>HTTP</code>
<strong>Data repository</strong> | the reproducibility service fetches (a) content for ERC creation, or (b) complete ERC, from different sources and stores crated ERC persistently at suitable repositories | <code>HTTP</code>, <code>FTP</code>, <code>WebDAV</code>, <code>git</code>
<strong>Registry</strong> | the reproducibility service can deliver metadata on published ERC to registries/catalogues/search portals, but also retrieve/harvest contextual metadata during ERC creation; users discover ERC via registries | (proprietary) <code>HTTP</code> APIs, persistent identifiers (<code>DOI</code>), <code>OAI-PMH</code>
<strong>Software repository</strong> | software repository provide software artifacts during ERC creation and store executable runtime environments | <code>HTTP</code> APIs
<strong>Archives and digital preservation systems</strong> | when information is transferred from the private (research group, single researcher) or group domain (collaborations) to a public and persistent domain (archives, repositories), then extended data and metadata management is needed but also different access and re-use is enabled; these concerns are only relevant in so far as <em>data repositories</em> must be supported, but further aspects such as access rights in archives are only mediately relevant for the reproducibility service | metadata in <code>JSON</code> and <code>XML</code> provided via <code>HTTP</code> or as files</p>
<h3 id="32-technical-context">3.2 Technical context<a class="headerlink" href="#32-technical-context" title="Permanent link">&para;</a></h3>
<p>All components use <code>HTTP</code> over cable networks connections for communication of all exchanged data (metadata documents, ERC, Linux containers, etc.).</p>
<h2 id="4-solution-strategy">4. Solution strategy<a class="headerlink" href="#4-solution-strategy" title="Permanent link">&para;</a></h2>
<p>This section provides a short overview of architecture decisions and for some the reasoning behind them.</p>
<h3 id="web-api">Web API<a class="headerlink" href="#web-api" title="Permanent link">&para;</a></h3>
<p>The developed solution is set in an existing system of services, and first and foremost must integrate well with these systems, focussing on the specific missing features of building and running ERCs.
These features are provided via a <em>well-defined RESTful API</em>.</p>
<h3 id="microservices">Microservices<a class="headerlink" href="#microservices" title="Permanent link">&para;</a></h3>
<p>To allow a dynamic development and support the large variety of skills, all server-side features are developed in independent <em><a href="https://en.wikipedia.org/wiki/Microservices">microservices</a></em>.
These microservices handle only specific functional parts of the API and allow independent development and deployment cycles.
Core components are developed using server-side JavaScript based on Node.js while other components are implemented Python.</p>
<p>We accept this diversification <em>increases complexity</em> of both development and testing environments and the deployment of said services.</p>
<p>Required documentation is minimal. The typical structure should follow common practices.</p>
<h3 id="storage-and-intra-service-communication">Storage and intra-service communication<a class="headerlink" href="#storage-and-intra-service-communication" title="Permanent link">&para;</a></h3>
<p>In accordance with the system scope, there is no reliable storage solution implemented.
The microservices simply share a common pointer to a local file system path.
Storage of ERC is only implemented to make the solution independent during development and for the needs of core functionality (temporal storage), but it is not a feature the solution will eventually provide.</p>
<p>The unifying component of the architecture is the <em>database</em>.
It is known to all microservices.</p>
<p>Some microservices communicate via an eventing mechanism for real-time updates, such as the search database and the component providing live updates to the user via WebSockets-
The eventing is based on the operation log of the database (which is normally used to synchronise database nodes).
This is a clear <em>misuse of an internal feature</em>, but a lot simpler than maintaining a full-blown eventing solution.</p>
<h3 id="demonstration-user-data-authentication">Demonstration, user data &amp; authentication<a class="headerlink" href="#demonstration-user-data-authentication" title="Permanent link">&para;</a></h3>
<p>To be able to demonstrate the system, a <em>browser-based client application</em> is developed.
It uses the RESTful API to control the system.
<em>OAuth 2.0</em> is used for authentication and minimal information, which is already public, is stored for each user.
This information is shared between all services which require authentication via the database.</p>
<p><em>The client application manages the control flow</em> of all user interactions.</p>
<h3 id="tools">Tools<a class="headerlink" href="#tools" title="Permanent link">&para;</a></h3>
<p>If standalone tools are developed, they should provide a command-line interface (CLI).
The CLI allows integration into microservices when needed and to package tools including their dependencies as containers.
Thanks to the container architecture and the controlled, we don't need to worry about documentation for or distribution/packaging of these tools.
It must only be ensured they are correctly installed using the microservice's Dockerfile.
The only required documentation is for the installation into a container and usage of the CLI.</p>
<h2 id="5-building-block-view">5. Building block view<a class="headerlink" href="#5-building-block-view" title="Permanent link">&para;</a></h2>
<h3 id="51-refinement-level-1">5.1 Refinement Level 1<a class="headerlink" href="#51-refinement-level-1" title="Permanent link">&para;</a></h3>
<h4 id="511-blackbox-publication-platforms">5.1.1 Blackbox Publication Platforms<a class="headerlink" href="#511-blackbox-publication-platforms" title="Permanent link">&para;</a></h4>
<p>Publications platforms are the online interaction points of users with scientific works.
Users create publications, e.g. submitting to a scientific journal, publishing on a pre-print server or archive, or collaborating in online repositories.
Users examine publications, e.g. browsing, searching, reading, downloading, or reviewing.</p>
<h4 id="512-blackbox-id-provider">5.1.2 Blackbox ID Provider<a class="headerlink" href="#512-blackbox-id-provider" title="Permanent link">&para;</a></h4>
<p>Identification information of distributed systems is crucial, and for security reasons as well as for limiting manual reproduction of metadata, a central service can provide all of</p>
<ul>
<li>unique <em>identification of users</em> and <em>metadata on users</em>,</li>
<li><em>authentication</em> of users, and</li>
<li>metadata on a user's <em>works</em>, e.g. publications or ERC.</li>
</ul>
<p>Persistent identifiers for artifacts in the reproducibility service itself are <em>not required</em>, as these are provided by data storage and registries.
However, services such as <a href="http://www.pidconsortium.eu/">ePIC</a> could allow to retrieve persistent IDs.</p>
<h4 id="513-blackbox-execution-infrastructure">5.1.3 Blackbox Execution Infrastructure<a class="headerlink" href="#513-blackbox-execution-infrastructure" title="Permanent link">&para;</a></h4>
<p>The execution infrastructure provides CPU time and temporary result storage space for execution of ERC, both "as is" and with manipulation, i.e. changed parameters.</p>
<h4 id="514-blackbox-data-repositories">5.1.4 Blackbox Data Repositories<a class="headerlink" href="#514-blackbox-data-repositories" title="Permanent link">&para;</a></h4>
<p>Data repositories are all services storing data but not software.
More specifically, they may store software "as data", but not with software-specific features such as code versioning or installation binaries for different computer architectures.
Data repositories may be self-hosted or public/free, domain-specific or generic.
They typically provide persistent identifiers or handles, e.g. a <a href="https://www.doi.org/">DOI</a> or <a href="https://en.wikipedia.org/wiki/Uniform_Resource_Name">URN</a>.
They are used both for loading created ERC and for storing the ERC created by the reproducibility service.</p>
<h4 id="515-blackbox-registries">5.1.5 Blackbox Registries<a class="headerlink" href="#515-blackbox-registries" title="Permanent link">&para;</a></h4>
<p>Registries are metadata indexes or catalogues.</p>
<p>They are recipients of metadata exports by the reproducibility service to share information about ERC, e.g. add a new ERC to an author's profile.
This requires the reproducibility services to translate the internal metadata model into the recipients data model and encoding. </p>
<p>They are sources of metadata during ERC creation when the information in the fetched content is used to query registries for additional information which can be offered to the user.</p>
<h4 id="516-blackbox-software-repositories">5.1.6 Blackbox Software Repositories<a class="headerlink" href="#516-blackbox-software-repositories" title="Permanent link">&para;</a></h4>
<p>Software repositories are a source and a sink for software at different abstraction levels.
They are a source for software artifacts or packages, such as system packages in install a library or language-specific extension packages.
They are a sink for executable images of software, which comprise a number of software artifacts, for a specific ERC instance.</p>
<h3 id="52-refinement-level-2">5.2 Refinement Level 2<a class="headerlink" href="#52-refinement-level-2" title="Permanent link">&para;</a></h3>
<h4 id="521-whitebox-publication-platforms">5.2.1 Whitebox Publication Platforms<a class="headerlink" href="#521-whitebox-publication-platforms" title="Permanent link">&para;</a></h4>
<p>Publication platforms can be roughly divided into two groups.
They can be either specific journals hosted independently, such as <a href="http://www.jstatsoft.org/">JStatSoft</a> or <a href="http://joss.theoj.org/">JOSS</a>, or a larger platform provided by a publisher to multiple journals, such as <a href="http://sciencedirect.com/">ScienceDirect</a>, <a href="http://www.mdpi.com/">MDPI</a>, <a href="https://link.springer.com/">SpringerLink</a>, or <a href="https://plos.org/">PLOS</a>.
To some extend, pre-print servers, for example <a href="https://osf.io/">OSF</a> or <a href="https://arxiv.org/">arXiv.org</a>, can also fall into the latter category.</p>
<p>Integration with the reproducibility service can happen via plug-ins to generic software, e.g. <a href="https://pkp.sfu.ca/ojs/">OJS</a>, or by bespoke extensions.
Integrations are based on the service's public API.</p>
<h4 id="522-whitebox-id-provider">5.2.2 Whitebox ID Provider<a class="headerlink" href="#522-whitebox-id-provider" title="Permanent link">&para;</a></h4>
<p>The reproducibility service uses <a href="http://orcid.org/">ORCID</a> to authenticate users and retrieve user and works metadata.
Internally, the user's public <code>ORCID</code> is the main identifier.</p>
<h4 id="523-whitebox-execution-infrastructure">5.2.3 Whitebox Execution Infrastructure<a class="headerlink" href="#523-whitebox-execution-infrastructure" title="Permanent link">&para;</a></h4>
<p>Such an infrastructure could be either self-hosted, e.g. <a href="https://www.docker.com/products/docker-swarm">Docker Swarm</a>-based, or use a cloud service provide, such as <a href="https://aws.amazon.com/ec2/">Amazon EC2</a>, <a href="http://cloud.docker.com/">Docker Cloud</a>, or even use continuous integration services such as <a href="https://travis-ci.org/">Travis CI</a> or <a href="https://about.gitlab.com/gitlab-ci/">Gitlab CI</a>.</p>
<h4 id="524-whitebox-data-repositories">5.2.4 Whitebox Data Repositories<a class="headerlink" href="#524-whitebox-data-repositories" title="Permanent link">&para;</a></h4>
<p><a href="./img/5.2-whitebox-data-repos.png"><img alt="whitebox data repositories" src="./img/5.2-whitebox-data-repos.png" /></a></p>
<p><strong>Collaboration platforms</strong>, e.g. <a href="http://sciebo.de/">ownCloud/Sciebo</a>, <a href="http://github.com/">GitHub</a>, <a href="http://sharelatex.com/">ShareLatex</a>, <a href="https://osf.io/">OSF</a>, allow users to create, store, and share their research (code, text, data, et cetera).
The reproducibility service fetches contents for building an ERC from them based on public links, e.g. a public GitHub repository or shared Sciebo folder.
It is possible that ERC creation is linked to a project/repository on a collaboration platform and updates trigger an ERC (re-)creation or execution.</p>
<p>Protocols: <code>WebDAV</code>, <code>ownCloud</code>, <code>HTTP</code> (including <a href="https://en.wikipedia.org/wiki/Webhook">webhooks</a>), <code>git</code></p>
<p><strong>Domain data repositories</strong>, e.g. <a href="https://www.pangaea.de/">PANGAEA</a> or <a href="http://dataservices.gfz-potsdam.de/portal/">GFZ Data Services</a>, can be accessed by the reproducibility service during creation and execution of ERC to download data.
Allowing access to data repositories reduces data duplication but requires control over/trust in the respective repository.</p>
<p>Protocol: <code>HTTP</code> APIs</p>
<p>Generic <strong>Repositories</strong>, e.g. <a href="https://zenodo.org/">Zenodo</a>, <a href="https://data.mendeley.com/">Mendeley Data</a>, <a href="http://figshare.com/">Figshare</a>, <a href="https://osf.io/">OSF</a>, provide (a) access to complete ERC stored in repositories for inspection and execution by the reproducibility service, and (b) storage of created ERC. repositories.</p>
<p>The reproducibility service <em>does not persistently store anything</em>.</p>
<p>Protocols: (authenticated) <code>HTTP</code> APIs</p>
<p><strong>Archives</strong>, e.g. using an installation of <a href="https://www.archivematica.org/">Archivematica</a>, might provide long-term preservation of ERC. Preservation lies in the responsibility of the repository, which might save the hosted content to an archive, or an archive harvests a repository.</p>
<p>Protocol: <code>HTTP</code> carrying bitstreams and metadata</p>
<h4 id="525-whitebox-registries">5.2.5 Whitebox Registries<a class="headerlink" href="#525-whitebox-registries" title="Permanent link">&para;</a></h4>
<p>Research data registries and websites, for example (<a href="https://www.uni-muenster.de/FB7_MultimediaSupport/CRIS_Infoseite/Forschungsdatenbank_Infoseite.html">CRIS</a>, <a href="https://www.datacite.org/">DataCite</a>, <a href="https://scholar.google.de/">Google Scholar</a>, <a href="https://www.scopus.com/">Scopus</a>, <a href="https://www.altmetric.com/">Altmetric</a>, to name just a few, collect metadata on publications and provide services with this data.
Services comprise discovery but also derivation of citation data and creating networks of researchers and publications.</p>
<p>The listed examples include open platforms, commercial solutions, and institution-specific platforms.
Some of the registries offer a public, well-defined API to retrieve structured metadata and to create new records.</p>
<p>Protocol: <code>HTTP</code> APIs</p>
<h4 id="526-whitebox-software-repositories">5.2.6 Whitebox Software Repositories<a class="headerlink" href="#526-whitebox-software-repositories" title="Permanent link">&para;</a></h4>
<p><a href="./img/5.2-whitebox-software-repos.png"><img alt="whitebox software repositories" src="./img/5.2-whitebox-software-repos.png" /></a></p>
<h5 id="5261-blackbox-package-repositories">5.2.6.1 Blackbox Package repositories<a class="headerlink" href="#5261-blackbox-package-repositories" title="Permanent link">&para;</a></h5>
<p>Package repositories are used during ERC creation to download and install software artifacts for specific operating systems, e.g. <a href="https://wiki.debian.org/Apt">Debian APT</a> or <a href="https://launchpad.net/ubuntu">Ubuntu Launchpad</a>, for specific programming languages or environments, e.g. <a href="https://cran.r-project.org/">CRAN</a>, or from source, e.g. <a href="https://github.com/">GitHub</a>.</p>
<h5 id="5262-blackbox-container-registries">5.2.6.2 Blackbox Container registries<a class="headerlink" href="#5262-blackbox-container-registries" title="Permanent link">&para;</a></h5>
<p>Container registries such as <a href="https://hub.docker.com/">Docker Hub</a>, <a href="https://quay.io/">Quay</a>, self-hosted <a href="https://github.com/docker/distribution">Docker Registry 2.0</a> or <a href="https://aws.amazon.com/de/ecr/">Amazon ERC</a>, store executable images of runtime environments.
They can be used to distribute the runtime environments across the execution infrastructure and provide an intermediate ephemeral storage for the reproducibility service.</p>
<h4 id="527-whitebox-reproducibility-service">5.2.7 Whitebox Reproducibility Service<a class="headerlink" href="#527-whitebox-reproducibility-service" title="Permanent link">&para;</a></h4>
<p><a href="./img/5.2-whitebox-repro-service.png"><img alt="whitebox reproducibility service" src="./img/5.2-whitebox-repro-service.png" /></a></p>
<h5 id="5271-blackbox-webserver">5.2.7.1 Blackbox Webserver<a class="headerlink" href="#5271-blackbox-webserver" title="Permanent link">&para;</a></h5>
<p>A webserver handles all incoming calls to the API and distributes them to the respective microservice.
A working <a href="https://nginx.org">nginx</a> configuration is available <a href="https://github.com/o2r-project/o2r-platform/blob/master/test/nginx.conf">in the test setup</a>.</p>
<h5 id="5272-blackbox-ui">5.2.7.2 Blackbox UI<a class="headerlink" href="#5272-blackbox-ui" title="Permanent link">&para;</a></h5>
<p>The UI is a web application based on <a href="https://angularjs.org/">Angular JS</a>, see <a href="https://github.com/o2r-project/o2r-platform">o2r-platform</a>.
It connects to an execution microservice (µservice) for real-time WebSocket-based notifications.</p>
<h5 id="5273-blackbox-microservices">5.2.7.3 Blackbox microservices<a class="headerlink" href="#5273-blackbox-microservices" title="Permanent link">&para;</a></h5>
<p>The reproducibility service uses a <a href="https://en.wikipedia.org/wiki/Microservices">microservice architecture</a> to separate functionality defined by the <strong><a href="http://o2r.info/o2r-web-api">web API specification</a></strong> into manageable units.</p>
<p>This allows scalability (selected µservices can be deployed as much as needed) and technology independence for each use case and developer.
The µservices all access one main database and a shared file storage.</p>
<h5 id="5274-blackbox-tools">5.2.7.4 Blackbox Tools<a class="headerlink" href="#5274-blackbox-tools" title="Permanent link">&para;</a></h5>
<p>Some functionality is developed as standalone tools and used as such in the µservices instead of re-implementing features.
These tools are integrated via their command line interface (CLI).</p>
<h5 id="5275-blackbox-database">5.2.7.5 Blackbox Database<a class="headerlink" href="#5275-blackbox-database" title="Permanent link">&para;</a></h5>
<p>The main database is the unifying element of the microservice architecture.
All information shared between µservices or transactions between microservices are made via the database, including session state handling (= authentication).</p>
<p>A search database/index is used for full-text search and advanced search queries.</p>
<p>The database's operation log, normally used for synchronization between database nodes, is also used for </p>
<ul>
<li>event-driven communication between microservices, and</li>
<li>synchronization between main document database and search index.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This eventing "hack" is expected to be replaced by a proper eventing layer for productive deployments.</p>
</div>
<h5 id="5276-blackbox-ephemeral-file-storage">5.2.7.6 Blackbox Ephemeral file storage<a class="headerlink" href="#5276-blackbox-ephemeral-file-storage" title="Permanent link">&para;</a></h5>
<p>After loading from external sources and during creation of ERC, the files are stored in a file storage shared between the µservices.
The file structure is known to each microservice and read/write operations happen as needed.</p>
<h3 id="53-refinement-level-3">5.3 Refinement Level 3<a class="headerlink" href="#53-refinement-level-3" title="Permanent link">&para;</a></h3>
<h4 id="531-whitebox-services">5.3.1 Whitebox µservices<a class="headerlink" href="#531-whitebox-services" title="Permanent link">&para;</a></h4>
<p>Each microservice is encapsulated as a <a href="http://docker.com/">Docker</a> container running at its own port on an internal network and only serving its respective API path.
For testing or developing the <a href="https://github.com/o2r-project/o2r-platform">o2r-platform</a> GitHub project contains <a href="https://docs.docker.com/compose/compose-file/">docker-compose</a> configurations to run all microservices, see the repository's directory <code>/test</code> and check the projects <code>README.md</code> for instructions.</p>
<h5 id="erc-creation-and-examination">ERC creation and examination<a class="headerlink" href="#erc-creation-and-examination" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th><strong>Project</strong></th>
<th><strong>API path</strong></th>
<th><strong>Language</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/o2r-project/o2r-muncher">muncher</a></td>
<td><code>/api/v1/compendium</code> and <code>/api/v1/job</code></td>
<td>JavaScript (Node.js)</td>
<td>core component for CRUD of compendia and jobs (ERC execution)</td>
</tr>
<tr>
<td><a href="https://github.com/o2r-project/o2r-loader">loader</a></td>
<td><code>/api/v1/compendium</code> (<code>HTTP POST</code> only)</td>
<td>JavaScript (Node.js)</td>
<td>load workspaces from repositories and collaboration platforms</td>
</tr>
<tr>
<td><a href="https://github.com/o2r-project/o2r-finder">finder</a></td>
<td><code>/api/v1/search</code></td>
<td>JavaScript (Node.js)</td>
<td>discovery and search, synchronizes the database with a search database (Elasticsearch) and exposes read-only search endpoints</td>
</tr>
<tr>
<td><a href="https://github.com/o2r-project/o2r-transporter">transporter</a></td>
<td><code>~ /data/</code> and <code>~* \.(zip|tar|tar.gz)</code></td>
<td>JavaScript (Node.js)</td>
<td>downloads of compendia in zip or (gzipped) tar formats</td>
</tr>
<tr>
<td><a href="https://github.com/o2r-project/o2r-informer">informer</a></td>
<td><code>~* \.io</code></td>
<td>JavaScript (Node.js)</td>
<td><a href="http://socket.io/">socket.io</a>-based WebSockets for live updates to the UI based on database event log, e.g. job progress</td>
</tr>
<tr>
<td><a href="https://github.com/o2r-project/o2r-inspecter">inspecter</a></td>
<td><code>/api/v1/inspection</code></td>
<td>R (<a href="https://www.rplumber.io/">plumber</a>)</td>
<td>allow inspection of non-text-based file formats, e.g. <code>.Rdata</code></td>
</tr>
<tr>
<td><a href="https://github.com/o2r-project/o2r-substituter">substituter</a></td>
<td><code>/api/v1/substitution</code></td>
<td>JavaScript (Node.js)</td>
<td>create new ERCs based on existing ones by substituting files</td>
</tr>
<tr>
<td><a href="https://github.com/o2r-project/o2r-manipulater/">manipulater</a></td>
<td><code>under development</code></td>
<td>--</td>
<td>provide back-end containers for interactive ERCs</td>
</tr>
</tbody>
</table>
<h5 id="erc-exporting">ERC exporting<a class="headerlink" href="#erc-exporting" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th><strong>Project</strong></th>
<th><strong>API path</strong></th>
<th><strong>Language</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/o2r-project/o2r-shipper">shipper</a></td>
<td><code>/api/v1/shipment</code></td>
<td>Python</td>
<td>ship ERCs, including packaging, and their metadata to third party repositories and archives</td>
</tr>
</tbody>
</table>
<h5 id="authentication">Authentication<a class="headerlink" href="#authentication" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th><strong>Project</strong></th>
<th><strong>API path</strong></th>
<th><strong>Language</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/o2r-project/o2r-bouncer">bouncer</a></td>
<td><code>/api/v1/auth</code>, <code>/api/v1/user/</code></td>
<td>JavaScript (Node.js)</td>
<td>authentication service and user management (whoami, level changing)</td>
</tr>
</tbody>
</table>
<h4 id="532-whitebox-database">5.3.2 Whitebox database<a class="headerlink" href="#532-whitebox-database" title="Permanent link">&para;</a></h4>
<p>Two databases are used.</p>
<p><strong><a href="https://www.mongodb.com/">MongoDB</a> document database</strong> with enabled <a href="https://docs.mongodb.com/manual/core/replica-set-oplog/">replica-set oplog</a> for eventing.</p>
<p>Collections:</p>
<ul>
<li><code>users</code></li>
<li><code>sessions</code></li>
<li><code>compendia</code></li>
<li><code>jobs</code></li>
<li><code>shipments</code></li>
</ul>
<p>The MongoDB API is used by connecting µservices via suitable client packages, which are available for all required languages.</p>
<p><strong><a href="https://elastic.co">Elasticsearch</a> search index</strong>, kept in sync with the main document database by the µservice <code>finder</code>.
The ids are mapped to support update and delete operations.</p>
<p>The two main resources of the API are kept in separate indices due to <a href="https://www.elastic.co/blog/index-vs-type">their different structure/mappings</a>:</p>
<ul>
<li><code>compendia</code> with type <code>compendia</code></li>
<li><code>jobs</code> with type <code>jobs</code></li>
</ul>
<p>The search index is accessed by the UI through the search endpoint provided by <code>finder</code>.</p>
<h4 id="533-whitebox-tools">5.3.3 Whitebox tools<a class="headerlink" href="#533-whitebox-tools" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th><strong>project</strong></th>
<th><strong>language</strong></th>
<th><strong>description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/o2r-project/o2r-meta">meta</a></td>
<td>Python</td>
<td>scripts for extraction, translation and validation of metadata; for details see <a href="./metadata">metadata documentation</a></td>
</tr>
<tr>
<td><a href="https://github.com/o2r-project/containerit">containerit</a></td>
<td>R</td>
<td>generation of Dockerfiles based on R sessions and scripts</td>
</tr>
</tbody>
</table>
<h4 id="534-whitebox-ephemeral-file-storage">5.3.4 Whitebox ephemeral file storage<a class="headerlink" href="#534-whitebox-ephemeral-file-storage" title="Permanent link">&para;</a></h4>
<p>A host directory is mounted into every container to the same location: <code>/tmp/o2r:/tmp/o2r</code></p>
<hr />
<h2 id="credits">Credits<a class="headerlink" href="#credits" title="Permanent link">&para;</a></h2>
<p>This specification and guides are developed by the members of the project Opening Reproducible Research (<a href="https://www.uni-muenster.de/forschungaz/project/9520">Offene Reproduzierbare Forschung</a>) funded by the German Research Foundation (Deutsche Forschungsgemeinschaft (DFG) - Projektnummer <a href="http://gepris.dfg.de/gepris/projekt/274927273">274927273</a>) under grant numbers PE 1632/10-1, KR 3930/3-1, and TR 864/6-1).</p>
<blockquote>
<p><a href="http://o2r.info"><img alt="Opening Reproducible Research" src="./img/o2r-logo.png" /></a></p>
<p><em>Opening Reproducible Research (o2r, <a href="http://o2r.info/about">http://o2r.info/about</a>) is a DFG-funded research project by Institute for Geoinformatics (<a href="http://www.uni-muenster.de/Geoinformatics/">ifgi</a>) and University and Regional Library (<a href="https://www.ulb.uni-muenster.de/">ULB</a>), University of Münster, Germany. Building on recent advances in mainstream IT, o2r envisions a new architecture for storing, executing and interacting with the original analysis environment alongside the corresponding research data and manuscript. This architecture evolves around so called Executable Research Compendia (ERC) as the container for both research, review, and archival.</em></p>
</blockquote>
<hr />
<h2 id="license">License<a class="headerlink" href="#license" title="Permanent link">&para;</a></h2>
<p><img alt="CC-0 Button" src="https://licensebuttons.net/p/zero/1.0/88x31.png" /></p>
<p>The o2r architecture specification is licensed under <a href="https://creativecommons.org/publicdomain/zero/1.0/">Creative Commons CC0 1.0 Universal License</a>, see file <a href="https://raw.githubusercontent.com/o2r-project/architecture/arc42/LICENSE"><code>LICENSE</code></a>.
To the extent possible under law, the people who associated CC0 with this work have waived all copyright and related or neighboring rights to this work.
This work is published from: Germany.</p>
<hr />
<h2 id="about-arc42">About arc42<a class="headerlink" href="#about-arc42" title="Permanent link">&para;</a></h2>
<p>arc42, the Template for documentation of software and system architecture.</p>
<p>By Dr. Gernot Starke, Dr. Peter Hruschka and contributors.</p>
<p>Template Revision: 7.0 EN (based on asciidoc), January 2017</p>
<p>© We acknowledge that this document uses material from the arc 42 architecture template, <a href="http://www.arc42.de">http://www.arc42.de</a>. Created by Dr. Peter Hruschka &amp; Dr. Gernot Starke</p>
<div class="buildinfo">Build af7e2d6 @ 2018-01-30 15:10:06 +0100</div
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="user-scenarios/" class="btn btn-neutral float-right" title="User scenarios">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/o2r-project/architecture/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
      
        <span style="margin-left: 15px"><a href="user-scenarios/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '.';</script>
    <script src="./js/theme.js"></script>
      <script src="./search/require.js"></script>
      <script src="./search/search.js"></script>

</body>
</html>

<!--
MkDocs version : 0.17.2
Build Date UTC : 2018-01-30 14:12:39
-->
